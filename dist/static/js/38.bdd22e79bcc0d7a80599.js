(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{"73it":function(e,t,a){"use strict";var r=a("lwsE"),o=a.n(r),s=a("II3V");t.a=new function e(){o()(this,e),this.queryAirPage=s.a.makeGet("/api/air/report/queryReportPage4User"),this.exportAirReport=s.a.makeJPost("/api/air/report/exportReport4User"),this.queryTrainPage=s.a.makeGet("/api/train/report/queryReportPage4User"),this.exportTrainReport=s.a.makeJPost("/api/train/report/exportReport4User"),this.queryHotelPage=s.a.makeGet("/api/hotel/report/queryReportPage4User"),this.exportHotelReport=s.a.makeJPost("/api/hotel/report/exportReport4User"),this.queryCarPage=s.a.makeGet("/api/car/report/queryReportPage4User"),this.exportCarReport=s.a.makeJPost("/api/car/report/exportReport4User")}},u0BJ:function(e,t,a){"use strict";a.r(t);var r=a("lSNA"),l=a.n(r),o=a("o0o1"),c=a.n(o),s=a("yXPU"),p=a.n(s),u=a("Cd74"),m=a("+n12"),d=a("UMJ3"),h=a("73it"),f=a("eFjv"),y=a("38nE"),b=a("33P3");function _(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)}return a}var n={name:"TrainReport",components:{},setup:function(){var e=new Date;e.setDate(e.getDate()-30);var t={statisticalType:"1",dateType:"bookDate",beginTime:e.format("yyyy-MM-dd"),endTime:(new Date).format("yyyy-MM-dd 23:59:59"),trainCode:"",orderId:"",orderStatus:"60",orderSource:"",createUser:"",passenger:"",ticketNo:""},a=Object.assign({page:1,pageSize:20},t),r=Object(u.e)({loading:!1,exporting:!1,exportFile:"",searchForm:t,query:a,options:{orderStatusOptions:[],changeStatusOptions:[],refundStatusOptions:[],orderSourceOptions:[],departmentEmployeeOptions:[],statisticalType:[{code:"1",cname:"火车票订单明细"},{code:"2",cname:"火车票改签明细"},{code:"3",cname:"火车票退票明细"}]},tableData:{records:0,page:1,rows:[]},pickerOptions1:{disabledDate:function(e){return r.searchForm.endTime?e.getTime()>new Date(r.searchForm.endTime).getTime():e.getTime()>Date.now()}},pickerOptions2:{disabledDate:function(e){return r.searchForm.beginTime&&e.getTime()<new Date(r.searchForm.beginTime).getTime()||e.getTime()>Date.now()}}});r.transTableData=Object(u.a)(function(){return r.tableData}),r.fileName=Object(u.a)(function(){var e=r.options.statisticalType.find(function(e){return e.code===r.searchForm.statisticalType});return e?e.cname:""});var o=function(){var e=p()(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:f.a.getDicts({types:"TRAIN_ORDER_STATUS,TRAIN_CHANGE_STATUS,TRAIN_REFUND_CUSTOMER_STATUS,TRAIN_ORDER_SOURCE"}).then(function(e){r.options.orderStatusOptions=e.data.TRAIN_ORDER_STATUS,r.options.changeStatusOptions=e.data.TRAIN_CHANGE_STATUS,r.options.refundStatusOptions=e.data.TRAIN_REFUND_CUSTOMER_STATUS,r.options.orderSourceOptions=e.data.TRAIN_ORDER_SOURCE}),d.a.getDepartmentEmployeeOptions().then(function(e){r.options.departmentEmployeeOptions=e.data});case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),s=function(){var e=p()(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.loading=!0,e.prev=1,e.next=4,h.a.queryTrainPage(r.query);case 4:t=e.sent,r.tableData=t?t.data:{records:0,page:1,rows:[]},e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),r.tableData={records:0,page:1,rows:[]};case 11:return e.prev=11,r.loading=!1,e.finish(11);case 14:case"end":return e.stop()}},e,null,[[1,8,11,14]])}));return function(){return e.apply(this,arguments)}}(),n=function(){var e=p()(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.query.page=1,e.next=3,s();case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),i=function(){var e=p()(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Object.assign(r.query,r.searchForm),e.next=3,n();case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return i(),o(),function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?_(Object(a),!0).forEach(function(e){l()(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):_(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}({},Object(u.g)(r),{firstPage:n,refreshPage:s,onSearch:i,handleSizeChange:function(e){r.query.pageSize=e},handleSortChange:function(e){var t=e.sidx,a=e.sord;r.query.sidx=t,r.query.sord=a,n()},handleCurrentChange:function(e){r.query.page=e,s()},onChangeStatisticalType:function(e){"1"===e?(r.searchForm.dateType="bookDate",r.searchForm.orderStatus="60"):"2"===e?(r.searchForm.dateType="finishDate",r.searchForm.orderStatus="60"):"3"===e&&(r.searchForm.dateType="finishDate",r.searchForm.orderStatus="40"),i()},onDetail:function(e){Object(m.g)("#/train/order-detail?id=".concat(e.orderId,"&btm=0"),"/train/order-detail?id=".concat(e.orderId))},onExport:function(){return p()(c.a.mark(function e(){var t,a;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Object.assign(r.query,r.searchForm),r.exporting=!0,e.prev=2,e.next=5,h.a.exportTrainReport(r.query);case 5:t=e.sent,r.exportFile=t.data,a='导出成功，请点击 <a class="font-blue" href="'.concat(y.a.getFileUrl(r.exportFile),'" download="').concat(r.fileName,'">这里 </a>下载报表'),b.a.alert(a,"提示",{type:"success",dangerouslyUseHTMLString:!0}),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(2);case 13:return e.prev=13,r.exporting=!1,e.finish(13);case 16:case"end":return e.stop()}},e,null,[[2,11,13,16]])}))()}})}},i=a("KHd+"),v=Object(i.a)(n,function(){var a=this,e=a.$createElement,r=a._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:a.exporting,expression:"exporting"}],staticStyle:{"min-width":"1060px"}},[r("el-form",{attrs:{model:a.searchForm,inline:"",size:"mini","label-width":"70px",onkeydown:"if(event.keyCode==13){return false;}"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearch(e)}}},[r("el-row",[r("el-form-item",{attrs:{label:"日期条件",prop:"dateType","label-width":"80px"}},[r("template",{slot:"label"},["1"===a.searchForm.statisticalType?r("el-select",{staticClass:"w80",model:{value:a.searchForm.dateType,callback:function(e){a.$set(a.searchForm,"dateType",e)},expression:"searchForm.dateType"}},[r("el-option",{attrs:{value:"bookDate",label:"预订日期"}}),a._v(" "),r("el-option",{attrs:{value:"issueDate",label:"出票日期"}}),a._v(" "),r("el-option",{attrs:{value:"departDate",label:"乘车日期"}})],1):a._e(),a._v(" "),"2"===a.searchForm.statisticalType||"3"===a.searchForm.statisticalType?r("el-select",{staticClass:"w80",model:{value:a.searchForm.dateType,callback:function(e){a.$set(a.searchForm,"dateType",e)},expression:"searchForm.dateType"}},[r("el-option",{attrs:{value:"createDate",label:"申请日期"}}),a._v(" "),r("el-option",{attrs:{value:"confirmDate",label:"确认日期"}}),a._v(" "),r("el-option",{attrs:{value:"finishDate",label:"完成日期"}})],1):a._e()],1),a._v(" "),r("el-date-picker",{staticClass:"w130",attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"起始日期","picker-options":a.pickerOptions1},model:{value:a.searchForm.beginTime,callback:function(e){a.$set(a.searchForm,"beginTime",e)},expression:"searchForm.beginTime"}}),a._v(" "),r("span",{staticClass:"form-label"},[a._v(" 至 ")]),a._v(" "),r("el-date-picker",{staticClass:"w130",attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd 23:59:59",placeholder:"结束日期","picker-options":a.pickerOptions2},model:{value:a.searchForm.endTime,callback:function(e){a.$set(a.searchForm,"endTime",e)},expression:"searchForm.endTime"}})],2),a._v(" "),r("el-form-item",{attrs:{label:"订单号",prop:"orderId"}},[r("el-input",{staticClass:"w130",attrs:{clearable:"",placeholder:"订单号/取票单号"},model:{value:a.searchForm.orderId,callback:function(e){a.$set(a.searchForm,"orderId",e)},expression:"searchForm.orderId"}})],1),a._v(" "),r("el-form-item",{attrs:{label:"乘客名称",prop:"passenger"}},[r("el-input",{staticClass:"w130",attrs:{clearable:"",placeholder:"所有乘客"},model:{value:a.searchForm.passenger,callback:function(e){a.$set(a.searchForm,"passenger",e)},expression:"searchForm.passenger"}})],1),a._v(" "),r("el-form-item",{attrs:{label:" ","label-width":"15px"}},[r("el-button",{attrs:{type:"primary",icon:"el-icon-search",loading:a.loading},on:{click:a.onSearch}},[a._v("查 询")]),a._v(" "),r("c-delay-button",{attrs:{type:"warning",icon:"fa fa-file-excel-o"},on:{click:a.onExport}},[a._v(" 导 出\n        ")])],1)],1),a._v(" "),r("el-row",[r("el-form-item",{attrs:{label:"票号",prop:"ticketNo","label-width":"80px"}},[r("el-input",{staticClass:"w282",attrs:{clearable:"",placeholder:"所有票号"},model:{value:a.searchForm.ticketNo,callback:function(e){a.$set(a.searchForm,"ticketNo",e)},expression:"searchForm.ticketNo"}})],1),a._v(" "),"1"===a.searchForm.statisticalType?r("el-form-item",{attrs:{label:"预订员",prop:"createUser"}},[r("c-cascader",{staticClass:"w130",attrs:{filterable:"",clearable:"",placeholder:"所有预订员",options:a.options.departmentEmployeeOptions},model:{value:a.searchForm.createUser,callback:function(e){a.$set(a.searchForm,"createUser",e)},expression:"searchForm.createUser"}})],1):a._e(),a._v(" "),"2"===a.searchForm.statisticalType||"3"===a.searchForm.statisticalType?r("el-form-item",{attrs:{label:"申请人",prop:"createUser"}},[r("c-cascader",{staticClass:"w130",attrs:{filterable:"",clearable:"",placeholder:"所有申请人",options:a.options.departmentEmployeeOptions},model:{value:a.searchForm.createUser,callback:function(e){a.$set(a.searchForm,"createUser",e)},expression:"searchForm.createUser"}})],1):a._e(),a._v(" "),r("el-form-item",{attrs:{label:"订单来源",prop:"orderSource"}},[r("el-select",{staticClass:"w130",attrs:{clearable:"",placeholder:"所有订单来源"},model:{value:a.searchForm.orderSource,callback:function(e){a.$set(a.searchForm,"orderSource",e)},expression:"searchForm.orderSource"}},a._l(a.options.orderSourceOptions,function(e){return r("el-option",{key:e.code,attrs:{value:e.code,label:e.cname}})}),1)],1),a._v(" "),"1"===a.searchForm.statisticalType?r("el-form-item",{attrs:{label:"订单状态",prop:"orderStatus"}},[r("el-select",{staticClass:"w130",attrs:{clearable:"",placeholder:"所有订单状态"},model:{value:a.searchForm.orderStatus,callback:function(e){a.$set(a.searchForm,"orderStatus",e)},expression:"searchForm.orderStatus"}},a._l(a.options.orderStatusOptions,function(e){return r("el-option",{key:e.code,attrs:{value:e.code,label:e.cname}})}),1)],1):a._e(),a._v(" "),"2"===a.searchForm.statisticalType?r("el-form-item",{attrs:{label:"改签状态",prop:"orderStatus"}},[r("el-select",{staticClass:"w130",attrs:{clearable:"",placeholder:"所有改签状态"},model:{value:a.searchForm.orderStatus,callback:function(e){a.$set(a.searchForm,"orderStatus",e)},expression:"searchForm.orderStatus"}},a._l(a.options.changeStatusOptions,function(e){return r("el-option",{key:e.code,attrs:{value:e.code,label:e.cname}})}),1)],1):a._e(),a._v(" "),"3"===a.searchForm.statisticalType?r("el-form-item",{attrs:{label:"退票状态",prop:"orderStatus"}},[r("el-select",{staticClass:"w130",attrs:{clearable:"",placeholder:"所有退票状态"},model:{value:a.searchForm.orderStatus,callback:function(e){a.$set(a.searchForm,"orderStatus",e)},expression:"searchForm.orderStatus"}},a._l(a.options.refundStatusOptions,function(e){return r("el-option",{key:e.code,attrs:{value:e.code,label:e.cname}})}),1)],1):a._e()],1),a._v(" "),r("el-row",[r("el-form-item",{attrs:{label:" ","label-width":"80px"}},[r("el-radio-group",{attrs:{size:"small"},on:{change:a.onChangeStatisticalType},model:{value:a.searchForm.statisticalType,callback:function(e){a.$set(a.searchForm,"statisticalType",e)},expression:"searchForm.statisticalType"}},[a._l(a.options.statisticalType,function(e){return[r("el-radio-button",{key:e.code,attrs:{label:e.code}},[a._v(a._s(e.cname))])]})],2)],1)],1)],1),a._v(" "),r("c-page-table",{directives:[{name:"loading",rawName:"v-loading",value:a.loading,expression:"loading"}],attrs:{data:a.transTableData},on:{"size-change":a.handleSizeChange,"sort-change":a.handleSortChange,"current-change":a.handleCurrentChange}},[r("el-table-column",{attrs:{type:"index",label:"序号",width:"35"}}),a._v(" "),r("el-table-column",{attrs:{prop:"orderSourceName",label:"订单来源","min-width":"70"}}),a._v(" "),"1"===a.searchForm.statisticalType?r("el-table-column",{key:"orderId",attrs:{prop:"orderId",label:"订单号","min-width":"105"},scopedSlots:a._u([{key:"default",fn:function(t){return[r("a",{staticClass:"font-blue",attrs:{href:"javascript:void(0)",title:"查看订单详情"},on:{click:function(e){return a.onDetail(t.row)}}},[a._v(a._s(t.row.orderId)+"\n        ")])]}}],null,!1,1059135705)}):a._e(),a._v(" "),"2"===a.searchForm.statisticalType?r("el-table-column",{key:"changeId",attrs:{prop:"changeId",label:"改签单号","min-width":"110"},scopedSlots:a._u([{key:"default",fn:function(t){return[r("a",{staticClass:"font-blue",attrs:{href:"javascript:void(0)",title:"查看改签单详情"},on:{click:function(e){return a.onDetail(t.row)}}},[a._v(a._s(t.row.changeId)+"\n        ")])]}}],null,!1,3949515636)}):a._e(),a._v(" "),"3"===a.searchForm.statisticalType?r("el-table-column",{key:"refundId",attrs:{prop:"refundId",label:"退单号","min-width":"110"},scopedSlots:a._u([{key:"default",fn:function(t){return[r("a",{staticClass:"font-blue",attrs:{href:"javascript:void(0)",title:"查看退票单详情"},on:{click:function(e){return a.onDetail(t.row)}}},[a._v(a._s(t.row.refundId)+"\n        ")])]}}],null,!1,3350003379)}):a._e(),a._v(" "),r("el-table-column",{attrs:{prop:"passengerName",label:"乘客名称","min-width":"65","show-overflow-tooltip":""}}),a._v(" "),r("el-table-column",{attrs:{prop:"ticketNo",label:"票号","min-width":"100","show-overflow-tooltip":""},scopedSlots:a._u([{key:"default",fn:function(e){return["1"===a.searchForm.statisticalType||"3"===a.searchForm.statisticalType?[r("div",{staticClass:"text-truncate"},[a._v(a._s(e.row.ticketNo))])]:"2"===a.searchForm.statisticalType?[r("div",{staticClass:"text-truncate"},[a._v(a._s(e.row.newTicketNo))])]:a._e()]}}])}),a._v(" "),r("el-table-column",{attrs:{prop:"departDateTime",label:"乘车日期","min-width":"105"},scopedSlots:a._u([{key:"default",fn:function(e){return["1"===a.searchForm.statisticalType||"3"===a.searchForm.statisticalType?[r("div",{staticClass:"text-wrap"},[a._v(a._s(a._f("datetimeShortFormat1")(e.row.departDateTime)))])]:"2"===a.searchForm.statisticalType?[r("div",{staticClass:"text-wrap"},[a._v(a._s(a._f("datetimeShortFormat1")(e.row.newDepartDateTime)))])]:a._e()]}}])}),a._v(" "),r("el-table-column",{attrs:{prop:"",label:"行程摘要","min-width":"150"},scopedSlots:a._u([{key:"default",fn:function(e){return["1"===a.searchForm.statisticalType||"3"===a.searchForm.statisticalType?[r("div",{staticClass:"text-wrap"},[a._v(a._s(e.row.departStation)+"-"+a._s(e.row.arriveStation)+" "+a._s(e.row.trainCode)+"次")]),a._v(" "),r("div",{staticClass:"text-wrap"},[a._v(a._s(e.row.seatClassName)+" "+a._s(e.row.seatNo))])]:"2"===a.searchForm.statisticalType?[r("div",{staticClass:"text-wrap"},[a._v(a._s(e.row.newDepartStation)+"-"+a._s(e.row.newArriveStation)+" "+a._s(e.row.newTrainCode)+"次")]),a._v(" "),r("div",{staticClass:"text-wrap"},[a._v(a._s(e.row.newSeatClassName)+" "+a._s(e.row.newSeatNo))])]:a._e()]}}])}),a._v(" "),"1"===a.searchForm.statisticalType?r("el-table-column",{key:"total1",attrs:{prop:"total",label:"销售总价",width:"55"}}):a._e(),a._v(" "),"2"===a.searchForm.statisticalType?r("el-table-column",{key:"total2",attrs:{prop:"total",label:"应付金额",width:"55"}}):a._e(),a._v(" "),"3"===a.searchForm.statisticalType?r("el-table-column",{key:"refundAmount",attrs:{prop:"refundAmount",label:"应退金额",width:"55"}}):a._e(),a._v(" "),"1"===a.searchForm.statisticalType?r("el-table-column",{key:"statusName1",attrs:{prop:"statusName",label:"订单状态","min-width":"60"}}):a._e(),a._v(" "),"2"===a.searchForm.statisticalType?r("el-table-column",{key:"statusName2",attrs:{prop:"statusName",label:"改签状态","min-width":"60"}}):a._e(),a._v(" "),"3"===a.searchForm.statisticalType?r("el-table-column",{key:"customerStatusName",attrs:{prop:"customerStatusName",label:"退票状态","min-width":"60"}}):a._e(),a._v(" "),r("el-table-column",{attrs:{prop:"contactName",label:"联系人","min-width":"55"}}),a._v(" "),r("el-table-column",{attrs:{prop:"contactPhone",label:"联系号码","min-width":"55"}}),a._v(" "),"1"===a.searchForm.statisticalType?r("el-table-column",{key:"createUserName1",attrs:{prop:"createUserName",label:"预订员","min-width":"55"}}):a._e(),a._v(" "),"1"===a.searchForm.statisticalType?r("el-table-column",{key:"createTime1",attrs:{prop:"createTime",label:"预订时间","min-width":"120",sortable:"custom"},scopedSlots:a._u([{key:"default",fn:function(e){return[a._v("\n        "+a._s(a._f("datetimeFormat")(e.row.createTime))+"\n      ")]}}],null,!1,1342051511)}):a._e(),a._v(" "),"2"===a.searchForm.statisticalType||"3"===a.searchForm.statisticalType?r("el-table-column",{key:"createUserName2",attrs:{prop:"createUserName",label:"申请人","min-width":"55"}}):a._e(),a._v(" "),"2"===a.searchForm.statisticalType?r("el-table-column",{key:"finishTime",attrs:{prop:"finishTime",label:"改签完成时间","min-width":"120",sortable:"custom"},scopedSlots:a._u([{key:"default",fn:function(e){return[a._v("\n        "+a._s(a._f("datetimeFormat")(e.row.finishTime))+"\n      ")]}}],null,!1,1005384800)}):a._e(),a._v(" "),"3"===a.searchForm.statisticalType?r("el-table-column",{key:"customerFinishTime",attrs:{prop:"customerFinishTime",label:"退票完成时间","min-width":"120",sortable:"custom"},scopedSlots:a._u([{key:"default",fn:function(e){return[a._v("\n        "+a._s(a._f("datetimeFormat")(e.row.customerFinishTime))+"\n      ")]}}],null,!1,105138116)}):a._e()],1)],1)},[],!1,null,null,null);t.default=v.exports}}]);